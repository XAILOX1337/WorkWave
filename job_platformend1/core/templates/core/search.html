
{% extends 'core/base.html' %}

{% block title %}Список вакансий{% endblock %}

{% block content %}
<link rel="stylesheet" href="../../static/CSS/search.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    .filters-overlay {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100%;
      background-color: #F4F5F9;
      box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease-in-out;
      padding: 20px;
      overflow-y: auto;
      z-index: 1000;
    }
    .filters-overlay.active {
      right: 0;
    }
    .filters-overlay .back-button {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      cursor: pointer;
      color: #3b82f6;
    }
    .filters-overlay .back-button i {
      font-size: 18px;
    }
    .filters-overlay .title {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
    }
    .filters-overlay .label {
      font-size: 16px;
      color: #333;
      margin-bottom: 10px;
    }
    .filters-overlay .input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .filters-overlay .input-half {
      width: calc(50% - 5px);
    }
    .filters-overlay .checkbox-label, .filters-overlay .radio-label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .filters-overlay .submit-button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #3b82f6;
      color: white;
      cursor: pointer;
      margin-top: 20px;
    }
</style>

<div class="containerr">
    <h1 class="page-title">Вакансии для вас</h1>
    
    <div class="search-bar">
        <form method="get" action="{% url 'vacancy_list' %}" class="search-form">
            <input type="text" name="query" placeholder="Поиск по названию или описанию" value="{{ query }}" class="search-input">
            <button type="submit" class="search-button">Найти</button>
            <button type="button" class="filter-button" onclick="toggleFilters()">
                <i class="fas fa-sliders-h"></i> Фильтры
            </button>
        </form>
    </div>
    
    <div class="content-wrapper">
        <div class="sidebar">
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <i class="fas fa-file-alt icon"></i>
                    <a href="">Мое резюме</a>
                </li>
                <li class="sidebar-item">
                    <i class="fas fa-briefcase icon"></i>
                    <a href="{% url 'favorite_vacancies' %}">Мои вакансии</a>
                    <span class="badge">2</span>
                </li>
                <li class="sidebar-item">
                    <i class="fas fa-star icon"></i>
                    <a href="{% url 'favorite_vacancies' %}">Избранные вакансии</a>
                    <span class="badge" id="favorite-count">0</span>
                </li>
            </ul>
        </div>
        
        <div class="vacancies-list">
            {% for vacancy in vacancies %}
            <a href="{% url 'vacancy_detail' vacancy.id %}" class="vacancy-link">
                <div class="vacancy-card">
                    <div class="vacancy-header">
                        <div class="vacancy-info">
                            <h2 class="vacancy-title">{{ vacancy.title }}</h2>
                            <p class="salary">{{ vacancy.salary }} ₽</p>
                            <span class="experience">Опыт 1-3 года</span>
                            <p class="company">{{ vacancy.company }}</p>
                        </div>
                        <img src="{{ vacancy.photo.url }}" alt="Логотип компании {{ vacancy.company }}" class="company-logo">
                    </div>
                    <div class="tags-container">
                        {% for tag in vacancy.tags.all %}
                            <span class="tag">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    <div class="vacancy-actions">
                        <a href="{% url 'apply_for_vacancy' vacancy.id %}" class="apply-button">Откликнуться</a>
                        <div class="favorite-button">
                            {% if user.is_authenticated %}
                                {% if vacancy.id in favorite_vacancies %}
                                    <a href="{% url 'remove_from_favorite' vacancy.id %}" class="favorite-link">
                                        <i class="fas fa-heart" style="color: #ff0000;"></i>
                                    </a>
                                {% else %}
                                    <a href="{% url 'add_to_favorite' vacancy.id %}" class="favorite-link">
                                        <i class="far fa-heart" style="color: #7a7a7a;"></i>
                                    </a>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Блок фильтров -->
<form method="get" action="{% url 'home' %}">
    <div class="filters-overlay" id="filters-overlay">
        <div class="back-button" onclick="toggleFilters()">
            <span>Закрыть &#x2715;</span>
        </div>
        <h1 class="title">Поиск вакансий</h1>
        <h3>Фильтры по тегам:</h3>
        {% for tag in tags %}
            <label class="checkbox-label">
                <input type="checkbox" name="tags" value="{{ tag.id }}" 
                       {% if tag.id|stringformat:"s" in selected_tags %}checked{% endif %}>
                {{ tag.name }}
            </label><br>
        {% endfor %}
        <div class="mb-4">
            <label class="label">Заработная плата</label>
            <div class="flex space-x-4">
                <input type="text" placeholder="от 10 000" class="input input-half">
                <input type="text" placeholder="до 100 000" class="input input-half">
            </div>
        </div>
        <div class="mb-6">
            <label class="label">Образование</label>
            <div class="space-y-2">
                <label class="checkbox-label">
                    <input type="checkbox"> Не требуется или не указано
                </label>
                <label class="checkbox-label">
                    <input type="checkbox"> Среднее профессиональное
                </label>
                <label class="checkbox-label">
                    <input type="checkbox"> Высшее
                </label>
            </div>
        </div>
        <div class="mb-6">
            <label class="label">Требуемый опыт работы</label>
            <div class="space-y-2">
                <label class="radio-label">
                    <input type="radio" name="experience" checked> Не имеет значения
                </label>
                <label class="radio-label">
                    <input type="radio" name="experience"> Нет опыта
                </label>
                <label class="radio-label">
                    <input type="radio" name="experience"> От 1 года до 3 лет
                </label>
                <label class="radio-label">
                    <input type="radio" name="experience"> От 3 до 6 лет
                </label>
                <label class="radio-label">
                    <input type="radio" name="experience"> Более 6 лет
                </label>
            </div>
        </div>
        <div class="mb-6">
            <label class="label">Тип занятости</label>
            <div class="space-y-2">
                <label class="checkbox-label">
                    <input type="checkbox"> Полная занятость
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" checked> Частичная занятость
                </label>
                <label class="checkbox-label">
                    <input type="checkbox"> Проектная работа/разовое задание
                </label>
                <label class="checkbox-label">
                    <input type="checkbox"> Волонтерство
                </label>
            </div>
        </div>
        <div class="mb-6">
            <label class="label">Сортировка</label>
            <div class="space-y-2">
                <label class="radio-label">
                    <input type="radio" name="sort" checked> По соответствию
                </label>
                <label class="radio-label">
                    <input type="radio" name="sort"> По дате изменения
                </label>
                <label class="radio-label">
                    <input type="radio" name="sort"> По убыванию зарплаты
                </label>
                <label class="radio-label">
                    <input type="radio" name="sort"> По возрастанию зарплаты
                </label>
            </div>
        </div>
        <button type="submit" class="submit-button">Применить фильтры</button>
    </div>
</form>

<script>
    function toggleFilters() {
        const filtersOverlay = document.getElementById('filters-overlay');
        filtersOverlay.classList.toggle('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Обновляем счетчик избранных
        const favoriteButtons = document.querySelectorAll('.favorite-button .fas.fa-heart');
        document.getElementById('favorite-count').textContent = favoriteButtons.length;
    });
</script>
{% endblock %}